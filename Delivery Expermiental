local PathfindingService = game:GetService("PathfindingService")

game.Players.LocalPlayer.Character.ChildAdded:Connect(function(item)
    if item:FindFirstChild("House") then
        local house = item.House.Value
        local door = house:GetDescendants()

        for i = 1, #door do
            if door[i].Name == "GivePizza" then
                local character = game.Players.LocalPlayer.Character
                local humanoid = character:FindFirstChild("Humanoid")
                local rootPart = character:FindFirstChild("HumanoidRootPart")

                if humanoid and rootPart then
                    -- Ajustar la velocidad de caminar a 20
                    humanoid.WalkSpeed = 20

                    -- Crear una ruta segura hacia la puerta
                    local path = PathfindingService:CreatePath({
                        AgentRadius = 2, -- Radio del personaje
                        AgentHeight = 5, -- Altura del personaje
                        AgentCanJump = true, -- Permitir saltar
                        AgentJumpHeight = 5, -- Altura máxima de salto
                        AgentMaxSlope = 45 -- Inclinación máxima
                    })

                    -- Calcular la ruta
                    path:ComputeAsync(rootPart.Position, door[i].Position)

                    -- Revisar si se generó una ruta válida
                    if path.Status == Enum.PathStatus.Complete then
                        local waypoints = path:GetWaypoints()

                        -- Seguir cada waypoint
                        for _, waypoint in ipairs(waypoints) do
                            humanoid:MoveTo(waypoint.Position)

                            -- Verificar si el waypoint requiere salto
                            if waypoint.Action == Enum.PathWaypointAction.Jump then
                                humanoid.Jump = true
                            end

                            -- Esperar a que el personaje alcance el waypoint
                            humanoid.MoveToFinished:Wait()
                        end

                        -- Restaurar la velocidad una vez que llegue
                        humanoid.WalkSpeed = 16
                    else
                        warn("No se pudo encontrar una ruta hacia la puerta.")
                    end
                end
            end
        end
    end
end)
